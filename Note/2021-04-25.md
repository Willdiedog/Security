# 2021 攻防演练总结报告

## 得分规则的变更

相对于去年护网， 今年与防守方干系比较大的两个改动是

1. 降低了溯源的分数
2. 非法攻击线索可得分

去年防守方大部分精力用于溯源在安全设备收集到的攻击ip，大家花了很大力气，写了几份报告，但是得分并不及预期. 防守方和攻击方都准备了很多蜜罐. 背离了护网的初衷.
今年得分规则很明显偏向于挖掘客户环境中隐藏的真实攻击行为，客户环境中的木马后门， 蠕虫病毒， 黑产团伙甚至apt成为防守方的主要关注对象，实现了护网 + 净网

## Red Team

今年 Red Team 的攻击手法除 0day 外，也开始注重对流量检测设备的绕过. 使用较多的技术有 CDN，DoH，免杀马，隐蔽隧道，加密通信，流量测的攻击检测越来越难以检出

近几年用户侧的隐私技术越来越多， 像 安全通信的https，防止运营商侧分析的 DoH等， 给 Red Team 带来新思路的同时， 也给 Blue Team 和 安全设备的研发人员带来不少挑战

## Blue Team

相对于 Red Team，护网对于 Blue Team 的安全能力要求要低很多，防守的主力还是各种安全设备，这也导致很多防守方人员是外援，实习生甚至接触没几天的速成人员。这也意味着安全产品的易用性和实用性确实是经得起实战考验的. 护网结束后，对于安全建设不是很到位的客户，有了护网培训，日常中也能较好的把设备用起来.

但是对于红队开始亲睐的各种检测绕过姿势，安全设备的盲区，在有可靠检测方案补齐之前，还是要有一定安全能力的人员来进行人工补全.

## 护网单位的改变

今年我参与护网的公司, 参与护网之前, 安全建设极差. 安全设备仅有一台4年前升过级的防火墙; 员工为了个人方便, 用网线把两个隔离的网段打通; 员工把个人工作机器映射到公网, 且为弱密码的; 各种web账号用弱密码的; 电脑上有各种垃圾软件的; 各种奇葩情况. 而且这个客户在护网开始前刚被勒索过, 以前其上级单位护网也是以此二级单位为突破入口的.

护网准备期间, 我们先帮客户重新整顿了内网流量, 然后收敛各种包露面, 督促客户整改各个业务的弱密码. 最后加装了防火墙,hids, 态势感知等安全产品. 匆匆完成了基建.

护网开始前, 客户的预期仅仅是能坚持个两三天就好, 两三天之后, 预期增长到了安稳度过护网期间, 也是逐渐有了信心. 这期间客户对我们的排查工作非常配合.

护网后, 客户希望把一些护网临时试用的安全设备留下来继续使用, 客户的安全意识也有了很大提升.

相信有很多甲方公司,由于缺乏安全人员和安全意识, 很多员工甚至上层对企业的信息安全建设非常被动. 但在国家护网的推动下, 乙方安全公司驻场对甲方公司的网络进行优化, 并在护网期间进行良好的安全实战, 对甲方有非常积极的意义.

## 新的检测思路

### 关于去特征、加密化的攻击检测

这类攻击手法的溯源思路，一方面是从现有的攻击告警入手，逐层发现关联主机的异常，最终对攻击路径进行还原. 另一方面是基于UEBA的角度，对实体日常的通信进行画像，如果发现主机有异于以前的通信, 再结合一些简单的场景判断, 就可以通过生成低危告警的方式. 但是这类告警中, 往往有效告警占比并不高, 且需要对环境和安全有一定了解才能使用起来.

### 自家设备联动

护网期间, 我们大部分精力放在态势感知产品上, 虽然态势感知支持和防火墙, EDR联动, 但是仅仅为轻度的封堵策略层次的联动, 而且不够智能. 一线怕联动封堵出现问题, 单独出一个人维护防火墙.

其他联动思路/问题:

1. https 最常用的 TLS_ECDHE_ 加密方式, 旁路审计的探针并不支持导证书解密, 这就导致作为互联网入口的web服务对态势感知来说, 是透明的, 防守方只能通过waf, fw的告警日志进行研判, 有漏检的风险. 如果我们的串联设备能够把解密后的日志传给sip, 进行二次检测和日志存储, 会极大提高sip的覆盖面
2. EDR接入sip后, 会在sip产生病毒文件类的告警, 告警内容也只给了文件路径, md5, 病毒类型, 查杀引擎等信息, 如果要研判文件是否为异常, 只能拿md5去威胁情报/沙箱平台查询, 或者联系客户找到问题机器进行排查. 极大影响研判速度, 且此类告警较多, 也就导致后期客户不是很配合排查此类问题, 监控组人员也开始忽视此类告警. EDR如果可以在用户允许的情况下, 把查杀到的恶意文件上传到sip, 并提供下载会极大节省此流程
3. EDR接入sip产生的告警, 主要有可疑文件和可疑进程两类, 但是并不支持在告警上的进程/文件加白. 如果有进程, 特别是powershell频繁调用的情况下, 会产生大量告警, 影响使用, 建议添加此类白名单.
4. EDR作为终端设备, 其实能获取到终端的登录日志和命令日志, 这些信息对UEBA和账号安全， 异常检测等模块来说是非常有用的。 我们之前仅仅把这些日志交给siem模块， 其实并没有充分利用起来
